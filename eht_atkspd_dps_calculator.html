
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>EHT Attack Speed + DPS Calculator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-title" content="EHT Calc">
  <style>
    body { font-family: -apple-system, system-ui, Segoe UI, Roboto, Arial, sans-serif; max-width: 820px; margin: 1.25rem auto; padding: 0 14px; }
    h1 { font-size: 1.4rem; margin-bottom: .5rem; }
    h2 { font-size: 1.15rem; margin-top: 1.25rem; }
    .grid { display: grid; grid-template-columns: 190px 1fr; gap: 10px; align-items: center; }
    .card { border: 1px solid #e5e5e5; border-radius: 12px; padding: 14px; margin: 12px 0; box-shadow: 0 1px 0 rgba(0,0,0,.03); }
    .row { display: contents; }
    input[type="number"], select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 10px; font-size: 16px; }
    .muted { color: #666; font-size: .9rem; }
    .result { font-weight: 600; font-size: 1.05rem; margin-top: 6px; }
    .two-col { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; }
    .pill { display:inline-block; padding:3px 8px; border-radius:999px; border:1px solid #ddd; font-size:.85rem; }
    .footer { margin-top:16px; font-size:.85rem; color:#666; }
  </style>
</head>
<body>
  <h1>EHT Attack Speed + DPS Calculator</h1>

  <div class="card">
    <h2>Base & Buffs</h2>
    <div class="grid">
      <div class="row">
        <label>Class</label>
        <select id="cls">
          <option>Berserker</option>
          <option>Paladin</option>
          <option>Ranger</option>
          <option selected>Sorcerer</option>
        </select>
      </div>
      <div class="row">
        <label>Weapon Speed</label>
        <select id="weap">
          <option>Original</option>
          <option>Primal</option>
          <option selected>PVP/Boss</option>
        </select>
      </div>
      <div class="row">
        <label>Characteristic</label>
        <select id="char">
          <option value="0">None</option>
          <option value="0.07" selected>Heroic (+0.07)</option>
          <option value="0.10">Swift (+0.10)</option>
          <option value="0.03">Nimble (+0.03)</option>
        </select>
      </div>
      <div class="row">
        <label>Atk SPD Colour</label>
        <select id="col">
          <option value="0.00">Normal (+0.00)</option>
          <option value="0.10">Blue (+0.10)</option>
          <option value="0.20">Orange (+0.20)</option>
          <option value="0.30" selected>Purple (+0.30)</option>
        </select>
      </div>
      <div class="row">
        <label>Guild Buff (decimal)</label>
        <input id="guild" type="number" step="0.001" value="0.05">
      </div>
      <div class="row">
        <label>Secret Tech (decimal)</label>
        <input id="secret" type="number" step="0.001" value="0.10">
      </div>
      <div class="row">
        <label>Target Final ATK SPD</label>
        <input id="target" type="number" step="0.01" value="0.25">
      </div>
      <div class="row">
        <label>Quicken %</label>
        <input id="quicken" type="number" step="0.001" value="0">
      </div>
    </div>
    <div class="result mono" id="needLine">ATK SPD % required to hit target: —</div>
    <div class="result mono" id="equipLine">Equipment/Rune % still needed: —</div>
    <div class="result mono" id="finalLine">Final ATK SPD: —</div>
    <div class="muted">ATK SPD math: <span class="pill mono">required = 1 - (target / base)</span> · <span class="pill mono">final = base × (1 - total%) × (1 - quicken)</span></div>
  </div>

  <div class="card">
    <h2>DPS Inputs</h2>
    <div class="grid">
      <div class="row">
        <label>Weapon ATK (base)</label>
        <input id="atk" type="number" step="1" value="1000">
      </div>
      <div class="row">
        <label>ATK % (decimal)</label>
        <input id="atkPct" type="number" step="0.001" value="0.00">
      </div>
      <div class="row">
        <label>Racial % (decimal)</label>
        <input id="racialPct" type="number" step="0.001" value="0.00">
      </div>
      <div class="row">
        <label>Crit Chance (0–1)</label>
        <input id="crit" type="number" step="0.001" value="0.30">
      </div>
      <div class="row">
        <label>Crit DMG (extra, e.g. 1.0 = +100%)</label>
        <input id="critDmg" type="number" step="0.01" value="1.00">
      </div>
      <div class="row">
        <label>Other DMG Multiplier</label>
        <input id="otherMult" type="number" step="0.01" value="1.00">
      </div>
    </div>
    <div class="result mono" id="dmgLine">Effective Hit Damage: —</div>
    <div class="result mono" id="dpsLine">DPS (uses Final ATK SPD above): —</div>
    <div class="muted">DPS math: <span class="pill mono">damage = ATK × (1+ATK%) × (1+Racial%) × Other</span> · <span class="pill mono">E[crit] = (1-cc) + cc × (1+critDMG)</span> · <span class="pill mono">DPS = damage × E[crit] ÷ Final ATK SPD</span></div>
  </div>

  <div class="card footer">
    Tip: after publishing to GitHub Pages, open in Safari → Share → <b>Add to Home Screen</b> to use as an app.
  </div>

<script>
  const base = {
    "Original": {"Berserker":2.0, "Paladin":2.4, "Ranger":1.8, "Sorcerer":2.2},
    "Primal":   {"Berserker":2.0, "Paladin":2.4, "Ranger":1.8, "Sorcerer":2.2},
    "PVP/Boss": {"Berserker":2.2, "Paladin":2.5, "Ranger":2.0, "Sorcerer":2.3}
  };

  const els = (ids => ids.reduce((o,id)=> (o[id]=document.getElementById(id),o),{}))(
    ["cls","weap","char","col","guild","secret","target","quicken","needLine","equipLine","finalLine","atk","atkPct","racialPct","crit","critDmg","otherMult","dmgLine","dpsLine"]
  );

  function pct(x){ return (x*100).toFixed(2) + '%'; }
  function spd(x){ return x.toFixed(3); }
  function num(id){ return parseFloat(els[id].value || 0); }

  function recalc(){
    const cls = els.cls.value;
    const weap = els.weap.value;
    const baseSpd = base[weap][cls];

    const total = num("char") + num("col") + num("guild") + num("secret");
    const required = 1 - (num("target") / baseSpd);
    const equipNeeded = Math.max(0, required - total);

    let finalSpd = baseSpd * (1 - total);
    finalSpd = finalSpd * (1 - num("quicken"));

    els.needLine.textContent = `ATK SPD % required to hit target: ${pct(required)}`;
    els.equipLine.textContent = `Equipment/Rune % still needed: ${pct(equipNeeded)}`;
    els.finalLine.textContent = `Final ATK SPD: ${spd(finalSpd)} (base ${baseSpd})`;

    // DPS
    const atk = num("atk");
    const atkPct = num("atkPct");
    const racial = num("racialPct");
    const crit = Math.min(Math.max(num("crit"),0),1);
    const critDmg = num("critDmg");
    const other = num("otherMult");

    const baseDamage = atk * (1+atkPct) * (1+racial) * other;
    const expectedCrit = (1-crit) + crit * (1 + critDmg);
    const effDamage = baseDamage * expectedCrit;
    const dps = effDamage / Math.max(finalSpd, 0.0001);

    els.dmgLine.textContent = `Effective Hit Damage: ${effDamage.toFixed(2)}`;
    els.dpsLine.textContent = `DPS: ${dps.toFixed(2)}`;
  }

  Object.values(els).forEach(el => el.addEventListener('input', recalc));
  recalc();
</script>
</body>
</html>
